(this.webpackJsonpadmin_shop=this.webpackJsonpadmin_shop||[]).push([[7],{124:function(e,t,s){"use strict";s.r(t);var c=s(1),a=s(33);var l={getMessageByRoomId:e=>{const t="/chatrooms/getById?roomId=".concat(e);return a.a.get(t)},createNewRoom:()=>a.a.post("/chatrooms/createNewRoom"),addMessage:e=>a.a.put("/chatrooms/addMessage",e),getAllRoom:()=>a.a.get("/chatrooms/getAllRoom")},o=(s(94),s(0));const r=s(44)("http://localhost:5000");t.default=function(e){const[t,s]=Object(c.useState)([]),[a,i]=Object(c.useState)(localStorage.getItem("current-room")||""),[n,d]=Object(c.useState)([]),[m,j]=Object(c.useState)(""),[b,h]=Object(c.useState)(!1),[g,x]=Object(c.useState)(),p=async()=>{const e=await l.getAllRoom();return s(e.rooms),e.rooms};Object(c.useEffect)((()=>{p()}),[]);const u=async e=>{const t=await l.getMessageByRoomId(e);console.log("cotent",t.content),d(t.content||[])};return Object(c.useEffect)((()=>{a&&u(a)}),[a]),Object(c.useEffect)((()=>{r.on("receive_message",(e=>{console.log("Received message:",e),u(e.roomId)}))}),[]),Object(c.useEffect)((()=>{r.on("delete-room",(async e=>{console.log("delete-room",e),localStorage.removeItem("current-room");const t=await p();if(console.log(t),t.length>0){const e=t[0]._id;console.log(e),localStorage.setItem("current-room",e),i(e)}}))}),[]),Object(c.useEffect)((()=>{r.on("new_room_created",(e=>{console.log("New room created:",e),p()}))}),[r]),Object(c.useEffect)((()=>{r.on("new-message",(e=>{h(!0),x(e.roomId)}))}),[]),Object(o.jsxs)("div",{className:"page-wrapper",children:[Object(o.jsx)("div",{className:"page-breadcrumb",children:Object(o.jsx)("div",{className:"row",children:Object(o.jsxs)("div",{className:"col-7 align-self-center",children:[Object(o.jsx)("h4",{className:"page-title text-truncate text-dark font-weight-medium mb-1",children:"Chat"}),Object(o.jsx)("div",{className:"d-flex align-items-center",children:Object(o.jsx)("nav",{"aria-label":"breadcrumb",children:Object(o.jsxs)("ol",{className:"breadcrumb m-0 p-0",children:[Object(o.jsx)("li",{className:"breadcrumb-item text-muted active","aria-current":"page",children:"Apps"}),Object(o.jsx)("li",{className:"breadcrumb-item text-muted","aria-current":"page",children:"Chat"})]})})})]})})}),Object(o.jsx)("div",{className:"container-fluid",children:Object(o.jsx)("div",{className:"row",children:Object(o.jsx)("div",{className:"col-md-12",children:Object(o.jsx)("div",{className:"card",children:Object(o.jsxs)("div",{className:"row no-gutters",children:[Object(o.jsxs)("div",{className:"col-lg-3 col-xl-2 border-right",children:[Object(o.jsx)("div",{className:"card-body border-bottom",children:Object(o.jsx)("form",{children:Object(o.jsx)("input",{className:"form-control",type:"text",placeholder:"Search Contact"})})}),Object(o.jsx)("div",{className:"scrollable position-relative",style:{height:"calc(80vh - 111px)"},children:Object(o.jsx)("ul",{className:"mailbox list-style-none",children:Object(o.jsx)("li",{children:Object(o.jsx)("div",{className:"message-center",children:t&&t.map((e=>Object(o.jsxs)("a",{onClick:()=>(e=>{localStorage.setItem("current-room",e),i(e)})(e._id),style:{background:"".concat(a===e._id?"rgb(186, 186, 238)":"transparent")},className:"message-item d-flex align-items-center border-bottom px-3 py-2 active_user",children:[Object(o.jsxs)("div",{className:"user-img",children:[" ",Object(o.jsx)("img",{src:"https://img.icons8.com/color/36/000000/administrator-male.png",alt:"user",className:"img-fluid rounded-circle",width:"40px"})," ",Object(o.jsx)("span",{className:"profile-status away float-right"})]}),Object(o.jsxs)("div",{className:"w-75 d-inline-block v-middle pl-2",children:[Object(o.jsx)("h6",{className:"message-title mb-0 mt-1",children:e._id}),b&&g===e._id&&Object(o.jsx)("p",{style:{fontSize:"7px",color:"gray"},children:"New Message"})]})]},e._id)))})})})})]}),Object(o.jsxs)("div",{className:"col-lg-9  col-xl-10",children:[Object(o.jsx)("div",{className:"chat-box scrollable position-relative",style:{height:"calc(80vh - 111px)"},children:Object(o.jsx)("ul",{className:"chat-list list-style-none px-3 pt-3",children:n&&n.map(((e,t)=>e.is_admin?Object(o.jsx)("li",{className:"chat-item odd list-style-none mt-3",children:Object(o.jsxs)("div",{className:"chat-content text-right d-inline-block pl-3",children:[Object(o.jsxs)("div",{className:"box msg p-2 d-inline-block mb-1",children:["You: ",e.message]}),Object(o.jsx)("br",{})]})},t):Object(o.jsxs)("li",{className:"chat-item list-style-none mt-3",children:[Object(o.jsx)("div",{className:"chat-img d-inline-block",children:Object(o.jsx)("img",{src:"https://img.icons8.com/color/36/000000/administrator-male.png",alt:"user",className:"rounded-circle",width:"45"})}),Object(o.jsxs)("div",{className:"chat-content d-inline-block pl-3",children:[Object(o.jsx)("h6",{className:"font-weight-medium",children:e.name}),Object(o.jsxs)("div",{className:"msg p-2 d-inline-block mb-1",children:["Client: ",e.message]})]}),Object(o.jsx)("div",{className:"chat-time d-block font-10 mt-1 mr-0 mb-3"})]},t)))})}),Object(o.jsx)("div",{className:"card-body border-top",children:Object(o.jsxs)("div",{className:"row",children:[Object(o.jsx)("div",{className:"col-9",children:Object(o.jsx)("div",{className:"input-field mt-0 mb-0",children:Object(o.jsx)("input",{id:"textarea1",placeholder:"Type and enter",className:"form-control border-0",type:"text",onClick:()=>{h(!1)},onChange:e=>{j(e.target.value)},value:m})})}),Object(o.jsx)("div",{className:"col-3",children:Object(o.jsx)("a",{className:"btn-circle btn-lg btn-cyan float-right text-white",onClick:async()=>{if(!a||""===m.trim())return;const e={message:m,roomId:a,is_admin:!0};try{await l.addMessage(e),r.emit("send_message",e),j("")}catch(t){console.error("Failed to send message:",t)}},children:Object(o.jsx)("i",{className:"fas fa-paper-plane"})})})]})})]})]})})})})}),Object(o.jsx)("footer",{className:"footer text-center"})]})}},33:function(e,t,s){"use strict";var c=s(36),a=s.n(c),l=s(35),o=s.n(l);const r=a.a.create({baseURL:"http://localhost:5000/admin",headers:{"content-type":"application/json"},paramsSerializer:e=>o.a.stringify(e)});r.interceptors.request.use((async e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e.data instanceof FormData&&delete e.headers["content-type"],e})),r.interceptors.response.use((e=>e&&e.data?e.data:e),(e=>{throw e})),t.a=r},94:function(e,t,s){}}]);
//# sourceMappingURL=7.b7313006.chunk.js.map